
WITH filtered_open_events AS ( SELECT USER_ID, APP_GROUP_ID, CAMPAIGN_ID, MESSAGE_VARIATION_ID, PLATFORM, CARRIER, BROWSER, DEVICE_MODEL, TO_TIMESTAMP(TIME) AS event_time FROM BRAZE_USER_EVENT_DEMO_DATASET.PUBLIC.USERS_MESSAGES_PUSHNOTIFICATION_OPEN_VIEW WHERE TO_TIMESTAMP(TIME) BETWEEN '2023-06-01 08:00:00' AND '2023-06-01 09:00:00' ), filtered_influenced_open_events AS ( SELECT USER_ID, APP_GROUP_ID, CAMPAIGN_ID, MESSAGE_VARIATION_ID, PLATFORM, CARRIER, BROWSER, DEVICE_MODEL, TO_TIMESTAMP(TIME) AS event_time FROM BRAZE_USER_EVENT_DEMO_DATASET.PUBLIC.USERS_MESSAGES_PUSHNOTIFICATION_INFLUENCEDOPEN_VIEW WHERE TO_TIMESTAMP(TIME) BETWEEN '2023-06-01 08:00:00' AND '2023-06-01 09:00:00' ), filtered_bounce_events AS ( SELECT USER_ID, APP_GROUP_ID, CAMPAIGN_ID, MESSAGE_VARIATION_ID, PLATFORM, TO_TIMESTAMP(TIME) AS event_time FROM BRAZE_USER_EVENT_DEMO_DATASET.PUBLIC.USERS_MESSAGES_PUSHNOTIFICATION_BOUNCE_VIEW WHERE TO_TIMESTAMP(TIME) BETWEEN '2023-06-01 08:00:00' AND '2023-06-01 09:00:00' ), filtered_send_events AS ( SELECT USER_ID, APP_GROUP_ID, CAMPAIGN_ID, MESSAGE_VARIATION_ID, PLATFORM, AD_TRACKING_ENABLED, TO_TIMESTAMP(TIME) AS event_time FROM BRAZE_USER_EVENT_DEMO_DATASET.PUBLIC.USERS_MESSAGES_PUSHNOTIFICATION_SEND_VIEW WHERE TO_TIMESTAMP(TIME) BETWEEN '2023-06-01 08:00:00' AND '2023-06-01 09:00:00' ) SELECT COALESCE(se.APP_GROUP_ID, bo.APP_GROUP_ID, oe.APP_GROUP_ID, io.APP_GROUP_ID) AS APP_GROUP_ID, COALESCE(se.CAMPAIGN_ID, bo.CAMPAIGN_ID, oe.CAMPAIGN_ID, io.CAMPAIGN_ID) AS CAMPAIGN_ID, COALESCE(se.MESSAGE_VARIATION_ID, bo.MESSAGE_VARIATION_ID, oe.MESSAGE_VARIATION_ID, io.MESSAGE_VARIATION_ID) AS MESSAGE_VARIATION_ID, COALESCE(se.PLATFORM, bo.PLATFORM, oe.PLATFORM, io.PLATFORM) AS PLATFORM, MIN(COALESCE(se.AD_TRACKING_ENABLED, FALSE)) AS AD_TRACKING_DISABLED, MIN(oe.CARRIER) AS CARRIER, MIN(oe.BROWSER) AS BROWSER, MIN(oe.DEVICE_MODEL) AS DEVICE_MODEL, COUNT(DISTINCT se.USER_ID) AS unique_push_notification_sends, COUNT(se.USER_ID) AS total_push_notification_sends, COUNT(DISTINCT bo.USER_ID) AS unique_push_notification_bounced, COUNT(bo.USER_ID) AS total_push_notification_bounced, COUNT(DISTINCT oe.USER_ID) AS unique_push_notification_opened, COUNT(oe.USER_ID) AS total_push_notification_opened, COUNT(DISTINCT io.USER_ID) AS unique_push_notification_influenced_open, COUNT(io.USER_ID) AS total_push_notification_influenced_open FROM filtered_send_events se LEFT JOIN filtered_bounce_events bo ON se.USER_ID = bo.USER_ID AND se.CAMPAIGN_ID = bo.CAMPAIGN_ID AND se.MESSAGE_VARIATION_ID = bo.MESSAGE_VARIATION_ID AND se.PLATFORM = bo.PLATFORM LEFT JOIN filtered_open_events oe ON se.USER_ID = oe.USER_ID AND se.CAMPAIGN_ID = oe.CAMPAIGN_ID AND se.MESSAGE_VARIATION_ID = oe.MESSAGE_VARIATION_ID AND se.PLATFORM = oe.PLATFORM LEFT JOIN filtered_influenced_open_events io ON se.USER_ID = io.USER_ID AND se.CAMPAIGN_ID = io.CAMPAIGN_ID AND se.MESSAGE_VARIATION_ID = io.MESSAGE_VARIATION_ID AND se.PLATFORM = io.PLATFORM GROUP BY se.APP_GROUP_ID, se.CAMPAIGN_ID, se.MESSAGE_VARIATION_ID, se.PLATFORM, oe.CARRIER, oe.BROWSER, oe.DEVICE_MODEL ORDER BY se.APP_GROUP_ID, se.CAMPAIGN_ID, se.MESSAGE_VARIATION_ID, se.PLATFORM LIMIT 10;