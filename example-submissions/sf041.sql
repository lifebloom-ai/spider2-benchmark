WITH PricingData AS (
    SELECT 
        DATETIME, 
        MAX(VALUE) AS MAX_PRICE_VALUE, 
        TIMEZONE
    FROM 
        YES_ENERGY__SAMPLE_DATA.YES_ENERGY_SAMPLE.TS_GEN_SAMPLE
    WHERE 
        DATETIME >= '2022-10-01 00:00:00' AND DATETIME < '2022-10-02 00:00:00'
    GROUP BY DATETIME, TIMEZONE
),
RealTimeLoadData AS (
    SELECT 
        TRUNC(DATETIME, 'MINUTE') AS DATETIME_MIN, 
        AVG(LOAD) AS REAL_TIME_LOAD, 
        TIMEZONE
    FROM 
        YES_ENERGY__SAMPLE_DATA.YES_ENERGY_SAMPLE.RT_LOADS_SAMPLE
    WHERE 
        DATETIME >= '2022-10-01 00:00:00' AND DATETIME < '2022-10-02 00:00:00'
    GROUP BY DATETIME_MIN, TIMEZONE
),
RenewableGenerationData AS (
    SELECT 
        DATETIME, 
        SUM(VALUE) AS TOTAL_RENEWABLE_GEN, 
        TIMEZONE
    FROM 
        YES_ENERGY__SAMPLE_DATA.YES_ENERGY_SAMPLE.TS_GEN_SAMPLE
    WHERE 
        DATETIME >= '2022-10-01 00:00:00' AND DATATYPEID = '16' -- Hypothetical DATATYPEID for renewables
    GROUP BY DATETIME, TIMEZONE
)
SELECT 
    p.DATETIME,
    p.MAX_PRICE_VALUE AS PRICE_VALUE,
    COALESCE(r.REAL_TIME_LOAD, 0) AS REAL_TIME_LOAD,
    COALESCE(g.TOTAL_RENEWABLE_GEN, 0) AS TOTAL_RENEWABLE_GEN,
    p.TIMEZONE
FROM 
    PricingData p
LEFT JOIN 
    RealTimeLoadData r
ON 
    TRUNC(p.DATETIME, 'MINUTE') = r.DATETIME_MIN
LEFT JOIN
    RenewableGenerationData g
ON
    p.DATETIME = g.DATETIME
ORDER BY 
    p.DATETIME;